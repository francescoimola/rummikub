---
/* --- Imports --- */
import ProjectCanvas from "../components/project/ProjectCanvas.astro";
import PageHeading from "../components/PageHeading";
import { ButtonLink } from "../components/ButtonLink";
import Layout from "../layouts/Layout.astro";
import { Text, Flex, Grid, Box, Heading, Link } from "@radix-ui/themes";
import { ArrowRightIcon, ArrowTopRightIcon } from "@radix-ui/react-icons";
import { ServiceCard } from "../components/ServiceCard";
import { ServiceDialog } from "../components/ServiceDialog";

import ConsultingIcon from "../components/icons/ConsultingIcon.astro";
import WebDesignIcon from "../components/icons/WebDesignIcon.astro";
import ContentWritingIcon from "../components/icons/ContentWritingIcon.astro";
import EmailMarketingIcon from "../components/icons/EmailMarketingIcon.astro";
import MegaSeatingPlanLogo from "../components/icons/MegaSeatingPlanLogo.astro";
import Testimonial from "../components/Testimonial";
import { InnerSection } from "../components/InnerSection";
import { MainGrid } from "../components/MainGrid";
import SarahYLLogo from "../components/icons/SarahYLLogo.astro";
import BlueberryLogo from "../components/icons/BlueberryLogo.astro";
import { BottomCTA } from "../components/BottomCTA";
import { getFeaturedProjects } from "../utils/getFeaturedProjects";

const featuredProjects = await getFeaturedProjects();

const limitDescription = (text: string) => {
  if (!text) return "";
  const CHAR_LIMIT = 215;
  const WORD_LIMIT = 40;

  let truncated = text;

  // Character limit
  if (truncated.length > CHAR_LIMIT) {
    truncated = truncated.substring(0, CHAR_LIMIT).trim() + "...";
  }

  // Word limit
  const words = truncated.split(/\s+/);
  if (words.length > WORD_LIMIT) {
    truncated = words.slice(0, WORD_LIMIT).join(" ") + "...";
  }

  return truncated;
};
---

<Layout backgroundColor="var(--yellow-3)">
  <!-- --- Hero --- -->

  <!-- Slot: Main Heading -->
  <PageHeading slot="heading" className="page-heading">
    Honest <Text as="span" color="yellow">pixels</Text> and <Text
      as="span"
      color="yellow">words</Text
    > that <Text as="span" color="orange">connect your work</Text> to the people who
    need it most
  </PageHeading>

  <!-- Slot: Job Role (Hidden on mobile) -->
  <Box slot="role" display={{ initial: "none", sm: "block" }} asChild>
    <Flex direction="column">
      <Text size="3" weight="medium">Websites and copy, simple by design.</Text>
      <Text size="3" color="gray">Taking on projects for Q1 2026</Text>
    </Flex>
  </Box>

  <!-- Slot: Introduction Text -->
  <Flex slot="description" direction="column" gap="5" width="75%">
    <Text size="3">
      I help independent businesses and non-profits who are tired of apologising
      for their amateurish websites. Mostly by removing what shouldn't be
      there—until you're left with something clearer, more confident, and worth
      showing off.
    </Text>
    <ButtonLink
      href="/about#contact"
      size="3"
      style={{ alignSelf: "flex-start" }}
      highContrast>Start a project <ArrowRightIcon /></ButtonLink
    >
  </Flex>

  <!-- --- Page Content --- -->
  <Box slot="page-content" style={{ backgroundColor: "var(--gray-1)" }}>
    <!-- Main Content Grid -->
    <MainGrid>
      <!-- --- Selected Work --- -->
      <InnerSection title="Selected work">
        <Grid columns="1" gapY="8">
          {
            featuredProjects.map((project) => (
              <ProjectCanvas
                images={project.data.coverImages}
                title={project.data.title}
                description={limitDescription(project.data.heroDescription)}
                href={`/work/${project.data.slug}`}
              />
            ))
          }
        </Grid>
      </InnerSection>

      <!-- --- Services --- -->
      <InnerSection title="Where I can help">
        <Grid columns="1" gap="8">
          <Grid columns="1" gap="4">
            <Heading size="3" weight="medium" as="h2" highContrast>
              Bread and butter
            </Heading>
            <Grid columns={{ initial: "1", md: "2" }} gap="4">
              <ServiceCard title="Web Design & Development" href="/webdesign">
                <WebDesignIcon slot="icon" />
              </ServiceCard>

              <ServiceCard title="Website Consultations" href="/consultations">
                <ConsultingIcon slot="icon" />
              </ServiceCard>
            </Grid>
          </Grid>

          <Grid columns="1" gap="4">
            <Heading size="3" weight="medium" as="h2" highContrast>
              À la carte
            </Heading>
            <Grid columns={{ initial: "1", md: "2" }} gap="4">
              <ServiceDialog client:load type="content-writing">
                <ContentWritingIcon slot="cardIcon" />
              </ServiceDialog>

              <ServiceDialog client:load type="email-marketing">
                <EmailMarketingIcon slot="cardIcon" />
              </ServiceDialog>
            </Grid>
          </Grid>
        </Grid>
      </InnerSection>

      <!-- --- About Snippet --- -->
      <InnerSection title="About">
        <Flex direction="column" gap="6">
          <Flex direction="column" gap="3">
            <Text size="3" as="p" highContrast>
              I've spent years watching businesses of all sizes waste
              unbelievable amounts of money on erratic marketing and sloppy
              websites that inevitably confuse people and damage their
              reputation.
            </Text>
            <Text size="3" as="p" highContrast>
              Until I learned how to stop that from happening.
            </Text>
          </Flex>
          <ButtonLink
            href="/about"
            variant="soft"
            size="3"
            color="gray"
            highContrast
            style={{ alignSelf: "flex-start" }}
          >
            More about how I work <ArrowRightIcon />
          </ButtonLink>
        </Flex>
      </InnerSection>

      <!-- --- Testimonials --- -->
      <InnerSection title="Happy Clients">
        <Grid columns="1" gap="var(--space-10)">
          <Testimonial
            authorName="Rob Cowen"
            quote="Francesco has the rare talent of being able to embed himself in a niche that he previously knew nothing about, quickly understanding the intricacies and writing with the confidence of an insider"
            rating={5}
          >
            <aside slot="authorRole">
              Founder, <Link
                href="https://seatingplan.com"
                target="_blank"
                rel="noopener noreferrer">Mega Seating Plan</Link
              >
            </aside>
            <MegaSeatingPlanLogo slot="logo" />
          </Testimonial>
          <Testimonial
            authorName="Liv Pennington"
            quote="Francesco provided excellent tech support and reassurance for a web project. He's been very easy to work with."
            rating={5}
          >
            <aside slot="authorRole">
              <Link
                href="https://www.livpennington.com/"
                target="_blank"
                rel="noopener noreferrer">Artist & Arts Programmer</Link
              >
            </aside>
          </Testimonial>
          <MegaSeatingPlanLogo slot="logo" />

          <Testimonial
            authorName="Sarah Brown"
            quote="Great to work with. Helped me to rework my website copy to align with a new direction I wanted to take. He’s quick and responsive"
            rating={5}
          >
            <aside slot="authorRole">
              <Link
                href="https://www.sarahyuklan.com/"
                target="_blank"
                rel="noopener noreferrer">Holistic Coach</Link
              >
            </aside>
            <SarahYLLogo slot="logo" />
          </Testimonial>
          <Testimonial
            authorName="Carly Anchal"
            quote="A dream collaborator. Organised and strategic, he asks the right questions, does his research, and presents fantastic options"
            rating={5}
          >
            <aside slot="authorRole">
              <Link
                href="https://www.linkedin.com/in/carly-anchal-nee-little-3a9b7112"
                target="_blank"
                rel="noopener noreferrer">PR & Marketing Manager</Link
              >
            </aside>
            <BlueberryLogo slot="logo" />
          </Testimonial>
        </Grid>
      </InnerSection>
    </MainGrid>
  </Box>
  <BottomCTA
    slot="bottom-cta"
    heading="Put a face to the name"
    text="Schedule a free, 30-min chat. You tell me about your challenges and ideas. I'll tell you if I can help."
    backgroundColor="var(--yellow-5)"
  >
    <Flex justify="center" align="start" gap="4">
      <ButtonLink
        href="https://cal.com/francescoimola/intro"
        target="_blank"
        rel="noopener noreferrer"
        size="4"
        external
        highContrast
      >
        Book a free intro <ArrowTopRightIcon />
      </ButtonLink>
      <ButtonLink href="/about#contact" size="4" variant="soft" color="gray"
        >Contact directly</ButtonLink
      >
    </Flex>
  </BottomCTA>
</Layout>
