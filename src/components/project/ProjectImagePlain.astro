---
import { Text } from "@radix-ui/themes";
import { Image } from "astro:assets";
import type { HTMLAttributes } from "astro/types";

interface Props extends HTMLAttributes<"figure"> {
    // Direct usage
    image?: ImageMetadata;
    caption?: string;
    // MDX usage (src, title)
    src?: ImageMetadata;
    title?: string;
    // Shared
    alt: string;
    className?: string;
}

const { image, src, alt, caption, title, className, ...rest } = Astro.props;
const finalImage = (image ?? src)!;
const finalCaption = caption ?? title;
---

<figure
    class:list={["m-0", className]}
    style={{
        display: "flex",
        margin: 0,
        flexDirection: "column",
        gap: "var(--space-4)",
    }}
    {...rest}
>
    <Image
        src={finalImage}
        alt={alt}
        class="w-full h-auto"
        style={{
            width: "100%",
            height: "auto",
        }}
    />

    {
        finalCaption && (
            <Text size="2" color="gray" asChild>
                <figcaption>{finalCaption}</figcaption>
            </Text>
        )
    }
</figure>
